<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Ledger AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="app-container">
    
    <!-- Left Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="user-profile">
                <img src="{{ url_for('static', filename='Assets/Logo.png') }}" alt="Logo" class="profile-avatar" onerror="this.style.display='none'">
                <span class="user-name">M-Ledger AI</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-section="home">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                </svg>
                <span>Home</span>
            </a>
            
            <a href="#" class="nav-item" data-section="reports">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                </svg>
                <span>Reports</span>
            </a>
            
            <a href="#" class="nav-item" data-section="settings">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                </svg>
                <span>Settings</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <button class="theme-toggle" id="theme_toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                <span class="sun-icon">‚òÄÔ∏è</span>
                <span class="moon-icon">üåô</span>
            </button>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Header -->
        <header class="content-header">
            <h1 class="page-title" id="page_title">Home</h1>
            <button class="btn btn-primary" id="new_expense_btn" aria-label="Upload statement" title="Upload statement">
                <span>üì§ Upload Statement</span>
            </button>
        </header>
        
        <!-- Home Section -->
        <div class="content-section" id="home-section" style="display: block;">
        
        <!-- Upload Section -->
        <div class="upload-section" id="upload_section">
            <h2>üì§ Upload M-Pesa Statement</h2>
            <form id="upload_form" class="upload-form" enctype="multipart/form-data">
                <div class="file-input-wrapper">
                    <input type="file" name="statement" id="statement" required accept=".pdf">
                    <label for="statement" class="file-label">
                        <span class="file-icon">üìÑ</span>
                        <span class="file-text" id="file_text">Choose PDF File</span>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary" id="upload_btn" aria-label="Upload and process statement" title="Upload and process statement">
                    <span id="upload_btn_text">Upload & Process</span>
                    <span id="upload_spinner" class="spinner" style="display:none;">‚è≥</span>
                </button>
            </form>
            <div id="upload_status" class="upload-status"></div>
            
            <!-- Last Upload Info -->
            {% if uploaded_at %}
            <div class="last-upload-info">
                <div class="info-card">
                    <div class="info-header">üìä Last Statement Processed</div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">üìÖ Upload Date:</span>
                            <span class="info-value">{{ uploaded_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
                        </div>
                        {% if filename %}
                        <div class="info-item">
                            <span class="info-label">üìÑ File:</span>
                            <span class="info-value">{{ filename }}</span>
                        </div>
                        {% endif %}
                        {% if total_transactions %}
                        <div class="info-item">
                            <span class="info-label">üìù Transactions:</span>
                            <span class="info-value">{{ total_transactions }} records</span>
                        </div>
                        {% endif %}
                        {% if transactions and transactions|length > 0 %}
                        <div class="info-item">
                            <span class="info-label">üìÜ Date Range:</span>
                            <span class="info-value">
                                {{ transactions[-1].date }} to {{ transactions[0].date }}
                            </span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Filters -->
        <div class="filters-section">
            <button class="filter-toggle" id="filter_toggle" aria-label="Toggle filters" title="Show or hide filters">
                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd"/>
                </svg>
                Hide Filters
            </button>
            
            <div class="filter-controls" id="filter_controls">
                <div class="filter-row">
                    <div class="filter-group">
                        <label>From</label>
                        <input type="text" class="filter-input" placeholder="From" id="from_filter">
                    </div>
                    
                    <div class="filter-group">
                        <label>Start Date</label>
                        <input type="date" class="filter-input" id="start_date">
                    </div>
                    
                    <div class="filter-group">
                        <label>End Date</label>
                        <input type="date" class="filter-input" id="end_date">
                    </div>
                </div>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Type</label>
                        <select class="filter-input" id="type_filter" aria-label="Filter by transaction type">
                            <option value="all">All</option>
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                            <option value="charge">Charges</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <button class="btn btn-primary" id="apply_filters" aria-label="Apply filters" title="Apply filters">Apply</button>
                    </div>
                    
                    <div class="filter-group">
                        <button class="btn btn-secondary" id="reset_filters" aria-label="Reset filters" title="Reset filters">Reset</button>
                    </div>
                    
                    <div class="filter-group">
                        <button class="btn btn-secondary" id="download_pdf" aria-label="Download PDF report" title="Download PDF">üì• PDF</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Pills -->
        <div class="status-pills">
            <button class="status-pill active" data-status="all" aria-label="Show all transactions" title="Show all">All</button>
            <button class="status-pill" data-status="income" aria-label="Filter by income" title="Filter by income">Income</button>
            <button class="status-pill" data-status="expense" aria-label="Filter by expenses" title="Filter by expenses">Expenses</button>
            <button class="status-pill" data-status="charge" aria-label="Filter by charges" title="Filter by charges">Charges</button>
        </div>
        
        <!-- View Options -->
        <div class="view-options">
            <span class="view-label">View:</span>
            <div class="view-buttons">
                <button class="view-btn active" data-view="table" aria-label="Table view" title="Table view">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-1h5v2H5a1 1 0 01-1-1zm7 1h4a1 1 0 001-1v-1h-5v2zm0-4h5V8h-5v2zM9 8H4v2h5V8z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Transactions Table -->
        <div class="table-container">
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th class="checkbox-col">
                            <input type="checkbox" id="select_all" aria-label="Select all transactions" title="Select all">
                        </th>
                        <th class="sortable">DATE</th>
                        <th class="sortable">TIME</th>
                        <th class="sortable">REFERENCE</th>
                        <th class="sortable">TYPE</th>
                        <th class="sortable">PARTY</th>
                        <th>DETAILS</th>
                        <th class="sortable amount-col">AMOUNT</th>
                        <th>CATEGORY</th>
                        <th class="sortable">BALANCE</th>
                    </tr>
                </thead>
                <tbody id="transactions_tbody">
                    {% if transactions and transactions|length > 0 %}
                        {% for t in transactions %}
                        <tr data-category="{{ t.category }}">
                            <td class="checkbox-col">
                                <input type="checkbox" class="transaction-checkbox" aria-label="Select transaction" title="Select">
                            </td>
                            <td class="date-col">
                                <span class="date-icon">üìÖ</span>
                                {{ t.date }}
                            </td>
                            <td class="time-cell">{{ t.time }}</td>
                            <td><span class="reference-code">{{ t.reference }}</span></td>
                            <td><strong>{{ t.transaction_type }}</strong></td>
                            <td class="party-col">
                                {% if t.party and t.party != '-' %}
                                <span class="party-info {{ t.category }}">
                                    {% if t.category == 'income' %}
                                    üì• From: <strong>{{ t.party }}</strong>
                                    {% else %}
                                    üì§ To: <strong>{{ t.party }}</strong>
                                    {% endif %}
                                </span>
                                {% else %}
                                <span class="no-party">‚Äî</span>
                                {% endif %}
                            </td>
                            <td class="details-cell">{{ t.description }}</td>
                            <td class="amount-col {% if t.category == 'income' %}income-amount{% else %}expense-amount{% endif %}">
                                {% if t.category == 'income' %}+{% else %}-{% endif %}{{ t.amount|format_number }}
                            </td>
                            <td>
                                <span class="badge badge-{{ t.category }}">{{ t.category|upper }}</span>
                            </td>
                            <td class="balance-cell"><strong>{{ t.balance|format_number }}</strong></td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr id="no_transactions">
                            <td colspan="10" class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <div class="empty-text">No transactions to display</div>
                                <div class="empty-subtext">Upload an M-Pesa statement to get started</div>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <div class="pagination">
            <button class="pagination-btn" id="prev_page" disabled aria-label="Previous page" title="Go to previous page">‚Üê Previous</button>
            <span class="pagination-info" id="page_info">Page 1 of 1</span>
            <button class="pagination-btn" id="next_page" disabled aria-label="Next page" title="Go to next page">Next ‚Üí</button>
        </div>
        
        </div><!-- End Home Section -->
        
        <!-- Reports Section -->
        <div class="content-section" id="reports-section" style="display: none;">
            <div class="section-content">
                <div class="reports-grid">
                    <h2>üìä Financial Reports</h2>
                    
                    <!-- Report Cards -->
                    <div class="report-cards">
                        <div class="report-card" data-report="monthly">
                            <h3>Monthly Summary</h3>
                            <p>View your monthly income and expense reports</p>
                            <button class="btn btn-secondary report-btn" data-report="monthly" aria-label="Generate monthly report" title="Generate monthly report">Generate Report</button>
                        </div>
                        <div class="report-card" data-report="category">
                            <h3>Category Analysis</h3>
                            <p>Breakdown of expenses by category</p>
                            <button class="btn btn-secondary report-btn" data-report="category" aria-label="View category analysis" title="View category analysis">View Analysis</button>
                        </div>
                        <div class="report-card" data-report="yearly">
                            <h3>Yearly Overview</h3>
                            <p>Annual financial summary and trends</p>
                            <button class="btn btn-secondary report-btn" data-report="yearly" aria-label="View yearly overview" title="View yearly overview">View Overview</button>
                        </div>
                    </div>
                    
                    <!-- Monthly Summary Report -->
                    <div class="report-detail" id="monthly-report" style="display: none;">
                        <div class="report-header">
                            <h3>üìÖ Monthly Summary Report</h3>
                            <button class="btn btn-secondary back-to-reports" aria-label="Back to reports" title="Back">‚Üê Back</button>
                        </div>
                        <div class="report-content">
                            <div class="summary-cards">
                                <div class="summary-card income-card">
                                    <div class="card-icon">üí∞</div>
                                    <div class="card-content">
                                        <h4>Total Income</h4>
                                        <p class="card-value" id="monthly_income">KES 0.00</p>
                                        <span class="card-label">This Month</span>
                                    </div>
                                </div>
                                <div class="summary-card expense-card">
                                    <div class="card-icon">üí∏</div>
                                    <div class="card-content">
                                        <h4>Total Expenses</h4>
                                        <p class="card-value" id="monthly_expenses">KES 0.00</p>
                                        <span class="card-label">This Month</span>
                                    </div>
                                </div>
                                <div class="summary-card balance-card">
                                    <div class="card-icon">üìä</div>
                                    <div class="card-content">
                                        <h4>Net Balance</h4>
                                        <p class="card-value" id="monthly_net">KES 0.00</p>
                                        <span class="card-label">Income - Expenses</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="monthly-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Category Analysis Report -->
                    <div class="report-detail" id="category-report" style="display: none;">
                        <div class="report-header">
                            <h3>üìÇ Category Analysis</h3>
                            <button class="btn btn-secondary back-to-reports" aria-label="Back to reports" title="Back">‚Üê Back</button>
                        </div>
                        <div class="report-content">
                            <div class="category-list" id="category_breakdown">
                                <!-- Categories will be populated here -->
                            </div>
                            <div class="chart-container">
                                <canvas id="category-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Yearly Overview Report -->
                    <div class="report-detail" id="yearly-report" style="display: none;">
                        <div class="report-header">
                            <h3>üìà Yearly Overview</h3>
                            <button class="btn btn-secondary back-to-reports" aria-label="Back to reports" title="Back">‚Üê Back</button>
                        </div>
                        <div class="report-content">
                            <div class="summary-cards">
                                <div class="summary-card income-card">
                                    <div class="card-icon">üí∞</div>
                                    <div class="card-content">
                                        <h4>Annual Income</h4>
                                        <p class="card-value" id="yearly_income">KES 0.00</p>
                                        <span class="card-label">Year to Date</span>
                                    </div>
                                </div>
                                <div class="summary-card expense-card">
                                    <div class="card-icon">üí∏</div>
                                    <div class="card-content">
                                        <h4>Annual Expenses</h4>
                                        <p class="card-value" id="yearly_expenses">KES 0.00</p>
                                        <span class="card-label">Year to Date</span>
                                    </div>
                                </div>
                                <div class="summary-card balance-card">
                                    <div class="card-icon">üìä</div>
                                    <div class="card-content">
                                        <h4>Average Monthly</h4>
                                        <p class="card-value" id="yearly_average">KES 0.00</p>
                                        <span class="card-label">Monthly Average</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="yearly-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Section -->
        <div class="content-section" id="settings-section" style="display: none;">
            <div class="section-content">
                <div class="settings-container">
                    <h2>‚öôÔ∏è Settings</h2>
                    
                    <form id="settings_form">
                        <div class="settings-group">
                            <h3>Account Settings</h3>
                            <div class="setting-item">
                                <label for="username">Username</label>
                                <input type="text" id="username" name="username" class="form-input" placeholder="Enter username" value="M-Ledger User">
                            </div>
                            <div class="setting-item">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" class="form-input" placeholder="Enter email">
                                <small class="input-hint">Used for notifications and reports</small>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <h3>Notification Preferences</h3>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="email_notifications" name="email_notifications" checked>
                                    Email notifications for new transactions
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="weekly_reports" name="weekly_reports" checked>
                                    Weekly summary reports via email
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-actions">
                            <button type="submit" class="btn btn-primary" aria-label="Save settings" title="Save settings">üíæ Save Settings</button>
                            <button type="button" class="btn btn-secondary" id="reset_settings_btn" aria-label="Reset settings" title="Reset to default">üîÑ Reset</button>
                        </div>
                    </form>
                    
                    <div id="settings_status" class="settings-status"></div>
                </div>
            </div>
        </div>
        
        <!-- AI Chat Section -->
        <div class="ai-chat-section">
            <div class="chat-header">
                <h2>üí¨ Ask AI about your finances</h2>
                <button class="chat-toggle" id="chat_toggle" aria-label="Toggle chat" title="Toggle chat">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M5 8a1 1 0 011.707 0L10 11.293l3.293-3.294a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4A1 1 0 015 8z"/>
                    </svg>
                </button>
            </div>
            <div class="ai-chat-messages" id="ai_chat_messages">
                <div class="ai-chat-message bot">
                    <div class="bot-avatar">ü§ñ</div>
                    <div class="message-content">
                        Hello! I'm your M-Ledger AI assistant. Upload a statement and ask me questions about your finances.
                    </div>
                </div>
            </div>
            <form id="ai_chat_form" class="ai-chat-form">
                <input type="text" id="ai_chat_input" placeholder="Ask me anything..." autocomplete="off" aria-label="Chat input">
                <button type="submit" aria-label="Send message" title="Send">Send üì§</button>
            </form>
        </div>
        
        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>M-Ledger AI</h4>
                    <p>Smart financial management for M-Pesa users</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#" data-section="home">Home</a></li>
                        <li><a href="#" data-section="reports">Reports</a></li>
                        <li><a href="#" data-section="settings">Settings</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p><snappafica class="ac ke">Email</snappafica></p>
                    <p> +254 700 000 000</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 M-Ledger AI. All rights reserved. | snappafica</p>
            </div>
        </footer>
        
    </main>
    
</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>

</body>
</html>